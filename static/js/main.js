"use strict";
(()=>{var A=Object.defineProperty;var v=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var L=(e,t,n)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,a=(e,t)=>{for(var n in t||(t={}))R.call(t,n)&&L(e,n,t[n]);if(v)for(var n of v(t))H.call(t,n)&&L(e,n,t[n]);return e};var g=typeof MediaQueryList=="function"&&typeof MediaQueryList.prototype.addEventListener=="function";var f=e=>{document.documentElement.setAttribute("data-color-scheme",e)},M=e=>{let t=document.head.querySelector('meta[name="color-scheme"]');t&&(t.content=e)},i=matchMedia("(prefers-color-scheme: light)"),c=()=>{i.matches?f("light"):f("dark")};function S(e){switch(e){case"follow-system":{c(),M("dark light"),g?i.addEventListener("change",c):i.addListener(c);break}default:f(e),M(e),g?i.removeEventListener("change",c):i.removeListener(c);break}}function w(){let e=document.getElementById("share"),t=document.getElementById("btn-share");t&&t.addEventListener("click",()=>{e.select(),document.execCommand("copy"),e.blur(),t.classList.add("copied")})}var I=(e,t)=>{if(!t)return;let n=document.body.querySelector(`form [name="${e}"`);!n||(n.value=t)},N=e=>{if(!e.data||!e.data.type)return;let{type:t,data:n}=e.data;switch(t){case"usw-remove-stylus-button":document.querySelector("a#stylus").remove();case"usw-fill-new-style":{if(window.location.pathname!=="/api/oauth/authorize_style/new")return;I("name",n.name),I("code",n.sourceCode)}}};window.addEventListener("message",N);function b(){window.dispatchEvent(new MessageEvent("message",{data:{type:"usw-ready"},origin:"https://userstyles.world"}))}var l={colorScheme:"follow-system"},d="user-preferences",s=null;function m(){if(s)return s;let e=localStorage.getItem(d);if(!e)return localStorage.setItem(d,JSON.stringify(l)),l;let t=U(JSON.parse(e),l);return s=a(a({},l),t),localStorage.setItem(d,JSON.stringify(s)),s}function B(e){s=a(a({},s),e),localStorage.setItem(d,JSON.stringify(s))}function U(e,t){let n={};return e==null||typeof e!="object"||Array.isArray(e)?null:(Object.keys(e).forEach(o=>{let r=e[o];if(r==null||t[o]==null)return;let p=Array.isArray(r),E=Array.isArray(t[o]);p||E?p&&E&&(n[o]=r):typeof r=="object"&&typeof t[o]=="object"?n[o]=U(r,t[o]):typeof r==typeof t[o]&&(n[o]=r)}),n)}var y="usr-settings";function T(e){!window.location.pathname.startsWith("/account")||(document.getElementById(`${y}--color-scheme`).value=e.colorScheme)}function x(e){let t=document.getElementById(`${y}--save`);t&&t.addEventListener("click",()=>{let n={};n.colorScheme=document.getElementById(`${y}--color-scheme`).value,B(n),e()})}var h=new Set,u=()=>document.readyState==="complete"||document.readyState==="interactive",O=e=>h.add(e);if(!u()){let e=()=>{u()&&(document.removeEventListener("readystatechange",e),h.forEach(t=>t()),h.clear())};document.addEventListener("readystatechange",e)}var C=()=>{w(),b(),x(D),T(m())};u()?C():O(C);var D=()=>{let e=m();S(e.colorScheme)};S(m().colorScheme);})();
