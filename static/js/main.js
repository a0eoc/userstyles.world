"use strict";
(()=>{var R=Object.defineProperty;var v=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var L=(e,t,n)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,a=(e,t)=>{for(var n in t||(t={}))H.call(t,n)&&L(e,n,t[n]);if(v)for(var n of v(t))N.call(t,n)&&L(e,n,t[n]);return e};var g=typeof MediaQueryList=="function"&&typeof MediaQueryList.prototype.addEventListener=="function";var f=e=>{document.documentElement.setAttribute("data-color-scheme",e)},M=e=>{let t=document.head.querySelector('meta[name="color-scheme"]');t&&(t.content=e)},i=matchMedia("(prefers-color-scheme: light)"),c=()=>{i.matches?f("light"):f("dark")};function S(e){switch(e){case"follow-system":{c(),M("dark light"),g?i.addEventListener("change",c):i.addListener(c);break}default:f(e),M(e),g?i.removeEventListener("change",c):i.removeListener(c);break}}function w(){let e=document.getElementById("share"),t=document.getElementById("btn-share");t&&t.addEventListener("click",()=>{e.select(),document.execCommand("copy"),e.blur(),t.classList.add("copied")})}var y=new Set,l=()=>document.readyState==="complete"||document.readyState==="interactive",I=e=>y.add(e);if(!l()){let e=()=>{l()&&(document.removeEventListener("readystatechange",e),y.forEach(t=>t()),y.clear())};document.addEventListener("readystatechange",e)}var b=e=>{e&&e.remove()};var B=(e,t)=>{if(!t)return;let n=document.body.querySelector(`form [name="${e}"`);!n||(n.value=t)},D=e=>{if(!e.data||!e.data.type)return;let{type:t,data:n}=e.data;switch(t){case"usw-remove-stylus-button":b(document.querySelector("a#stylus"));case"usw-fill-new-style":{if(window.location.pathname!=="/api/oauth/authorize_style/new"||!n)return;B("name",n.name),B("code",n.sourceCode)}}};window.addEventListener("message",D);function T(){window.dispatchEvent(new MessageEvent("message",{data:{type:"usw-ready"},origin:"https://userstyles.world"}))}var m={colorScheme:"follow-system"},d="user-preferences",s=null;function u(){if(s)return s;let e=localStorage.getItem(d);if(!e)return localStorage.setItem(d,JSON.stringify(m)),m;let t=x(JSON.parse(e),m);return s=a(a({},m),t),localStorage.setItem(d,JSON.stringify(s)),s}function U(e){s=a(a({},s),e),localStorage.setItem(d,JSON.stringify(s))}function x(e,t){let n={};return e==null||typeof e!="object"||Array.isArray(e)?null:(Object.keys(e).forEach(o=>{let r=e[o];if(r==null||t[o]==null)return;let p=Array.isArray(r),E=Array.isArray(t[o]);p||E?p&&E&&(n[o]=r):typeof r=="object"&&typeof t[o]=="object"?n[o]=x(r,t[o]):typeof r==typeof t[o]&&(n[o]=r)}),n)}var h="usr-settings";function O(e){!window.location.pathname.startsWith("/account")||(document.getElementById(`${h}--color-scheme`).value=e.colorScheme)}function C(e){let t=document.getElementById(`${h}--save`);t&&t.addEventListener("click",()=>{let n={};n.colorScheme=document.getElementById(`${h}--color-scheme`).value,U(n),e()})}var A=()=>{w(),T(),C(j),O(u())};l()?A():I(A);var j=()=>{let e=u();S(e.colorScheme)};S(u().colorScheme);})();
