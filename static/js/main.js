"use strict";
(()=>{var C=Object.defineProperty;var L=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var M=(e,t,n)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,a=(e,t)=>{for(var n in t||(t={}))D.call(t,n)&&M(e,n,t[n]);if(L)for(var n of L(t))H.call(t,n)&&M(e,n,t[n]);return e};var f=typeof MediaQueryList=="function"&&typeof MediaQueryList.prototype.addEventListener=="function";var S=e=>{document.documentElement.setAttribute("data-color-scheme",e)},w=e=>{let t=document.head.querySelector('meta[name="color-scheme"]');t&&(t.content=e)},i=matchMedia("(prefers-color-scheme: light)"),c=()=>{i.matches?S("light"):S("dark")};function y(e){switch(e){case"follow-system":{c(),w("dark light"),f?i.addEventListener("change",c):i.addListener(c);break}default:S(e),w(e),f?i.removeEventListener("change",c):i.removeListener(c);break}}function U(){let e=document.getElementById("share"),t=document.getElementById("btn-share");t&&t.addEventListener("click",()=>{e.select(),document.execCommand("copy"),e.blur(),t.classList.add("copied")})}var h=new Set,m=()=>document.readyState==="complete"||document.readyState==="interactive",T=e=>h.add(e);if(!m()){let e=()=>{m()&&(document.removeEventListener("readystatechange",e),h.forEach(t=>t()),h.clear())};document.addEventListener("readystatechange",e)}var I=e=>{e&&e.remove()};var l=(e,t)=>{if(!t)return;let n=document.body.querySelector(`form [name="${e}"`);!n||(n.value=t)},N=`/* ==UserStyle==
@name           A new userstyle!
@namespace      userstyles.world
@version        1.0.0
==/UserStyle== */
`,$=e=>{!e||(/\/\* *?==UserStyle==/g.test(e)||(e=`${N}${e}`),l("code",e))},j=e=>{if(!e.data||!e.data.type)return;let{type:t,data:n}=e.data;switch(t){case"usw-remove-stylus-button":I(document.querySelector("a#stylus"));case"usw-fill-new-style":{if(window.location.pathname!=="/api/oauth/authorize_style/new"||!n)return;l("name",n.name);let s=n.metadata;s&&(l("description",s.description),l("license",s.license),l("homepage",s.license)),$(n.sourceCode)}}};window.addEventListener("message",j);function b(){window.dispatchEvent(new MessageEvent("message",{data:{type:"usw-ready"},origin:"https://userstyles.world"}))}var d={colorScheme:"follow-system"},u="user-preferences",o=null;function g(){if(o)return o;let e=localStorage.getItem(u);if(!e)return localStorage.setItem(u,JSON.stringify(d)),d;let t=x(JSON.parse(e),d);return o=a(a({},d),t),localStorage.setItem(u,JSON.stringify(o)),o}function B(e){o=a(a({},o),e),localStorage.setItem(u,JSON.stringify(o))}function x(e,t){let n={};return e==null||typeof e!="object"||Array.isArray(e)?null:(Object.keys(e).forEach(s=>{let r=e[s];if(r==null||t[s]==null)return;let E=Array.isArray(r),v=Array.isArray(t[s]);E||v?E&&v&&(n[s]=r):typeof r=="object"&&typeof t[s]=="object"?n[s]=x(r,t[s]):typeof r==typeof t[s]&&(n[s]=r)}),n)}var p="usr-settings";function A(e){!window.location.pathname.startsWith("/account")||(document.getElementById(`${p}--color-scheme`).value=e.colorScheme)}function O(e){let t=document.getElementById(`${p}--save`);t&&t.addEventListener("click",()=>{let n={};n.colorScheme=document.getElementById(`${p}--color-scheme`).value,B(n),e()})}var R=()=>{U(),b(),O(z),A(g())};m()?R():T(R);var z=()=>{let e=g();y(e.colorScheme)};y(g().colorScheme);})();
